<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì œìŠ¤íŠ¸ ì¶œì„ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- â‘  ê¸€ê¼´ ë¶ˆëŸ¬ì˜¤ê¸° -->
<link href="https://cdn.jsdelivr.net/gh/webfontworld/gmarket/GmarketSans.css" rel="stylesheet" />
<style>
  body {
      font-family: 'GmarketSans', sans-serif;
      padding: 1.2rem;
      margin: 0;
      background-color: #f2f2f2;
    }

    .tab-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .tab-buttons button {
      flex: 1;
      padding: 0.9rem;
      font-size: 1.2rem;
      border: none;
      border-radius: 8px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }

    .tab-buttons button:hover {
      background-color: #45a049;
    }

    .tab {
      display: none;
      padding: 1rem;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    .tab.active {
      display: block;
    }

    h2 {
      margin-top: 0;
    }

    /* ê° íƒ­ ë²„íŠ¼ì— ê³ ìœ í•œ ìƒ‰ìƒ ë¶€ì—¬ */
.tab-buttons button:nth-child(1) {
  background-color: #A3B18A; /* ì¶œì„ë¶€ */
}
.tab-buttons button:nth-child(2) {
  background-color: #6C91BF; /* ê²½ê¸° í¸ì„± */
}
.tab-buttons button:nth-child(3) {
  background-color: #D8A7A7; /* íšŒì› ê´€ë¦¬ */
}
.tab-buttons button:nth-child(4) {
  background-color: #E5C07B; /* ê²½ê¸° ì ìˆ˜ */
}
.tab-buttons button:nth-child(5) {
  background-color: #A67B5B; /* ì¶œì„ ê´€ë¦¬ */
}

  </style>
  <style>
    /* ì¶œì„ë¶€ íƒ­ ë‚´ select ìš”ì†Œ í°íŠ¸ì™€ íŒ¨ë”© í™•ëŒ€ */
    #attendanceTab select {
      font-size: 1.3rem;
      padding: 0.6rem 1rem;
    }
  
    /* ì¶œì„ë¶€ íƒ­ ë‚´ ë²„íŠ¼ë“¤ í°íŠ¸ ë° íŒ¨ë”© í™•ëŒ€ */
    #attendanceTab button {
      font-size: 1.3rem;
      padding: 0.8rem 1.2rem;
    }
  
    /* ì¶œì„ ìš”ì•½ ì˜ì—­ë„ ê°€ë…ì„± ê°œì„  */
    #attendanceSummary {
      font-size: 1.2rem;
      line-height: 1.8rem;
    }
  </style>
  <style>
    /* ê²½ê¸° í¸ì„± íƒ­ ë‚´ ì „ì²´ ê¸€ì í¬ê¸° í™•ëŒ€ */
    #matchTab {
      font-size: 1.3rem;
      line-height: 1.9rem;
    }
  
    /* ì…ë ¥ í•„ë“œì™€ ì…€ë ‰íŠ¸ ë°•ìŠ¤ í¬ê¸° ì¡°ì • */
    #matchTab input,
    #matchTab select {
      font-size: 1.3rem;
      padding: 0.6rem 1rem;
    }
  
    /* ë²„íŠ¼ í¬ê¸° í™•ëŒ€ */
    #matchTab button {
      font-size: 1.3rem;
      padding: 0.8rem 1.2rem;
    }
  
    /* ê²°ê³¼ ì¶œë ¥ ì˜ì—­ í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
    #matchResult {
      font-size: 1.2rem;
      line-height: 1.8rem;
    }
    #suggestA, #suggestB {
  font-size: 1.56rem;  /* 120% í™•ëŒ€ */
  font-weight: bold;
}
  </style>
  
</head>
<body>

  <!-- íƒ­ ë²„íŠ¼ -->
  <div class="tab-buttons">
    <button onclick="showTab('attendanceTab')">ì¶œì„ë¶€</button>
    <button onclick="showTab('matchTab')">ê²½ê¸°<br>í¸ì„±<br>1ê²½ê¸°</button>
    <button onclick="showTab('memberTab')">íšŒì›<br>ê´€ë¦¬</button>
    <button onclick="showTab('scoreTab')">ê²½ê¸°<br>ì ìˆ˜</button>

  </div>

  <!-- íƒ­ ì½˜í…ì¸  ì˜ì—­ -->
  <div id="attendanceTab" class="tab active">
    <h2>ì¶œì„ë¶€</h2>
    <!-- ì´í›„ ë‹¨ê³„ì—ì„œ ë‚´ìš© ì¶”ê°€ -->
     <!-- ë‚ ì§œ ì„ íƒ ì˜ì—­ -->
<div>
  <label>ë‚ ì§œ ì„ íƒ:</label><br>
  <select id="yearSelect"></select>
  <select id="monthSelect"></select>
  <select id="daySelect"></select>
  <span id="weekdayDisplay" style="margin-left: 1rem; font-weight: bold;"></span>
</div>
  <!-- ìˆœìœ„ë³„ ì„±ëª… ì„ íƒ ë° ì§€ê°/ì¡°í‡´ ì²´í¬ -->
<div style="margin-top: 1rem;">
  <!-- ì¶œì„ ëª…ë‹¨ ë§Œë“¤ê¸° ë²„íŠ¼ - ì‚´ì§ íŒŒë€ ê³„ì—´ë¡œ ë³€ê²½ -->
<button 
onclick="loadRankedAttendance()" 
style="background-color: #cce5ff; color: #003366; padding: 0.8rem 1.2rem; font-size: 1.3rem;">
ì¶œì„ ëª…ë‹¨ ë§Œë“¤ê¸°
</button>

<!-- ì¶œì„ ëª…ë‹¨ ì „ì²´ ì‚­ì œ ë²„íŠ¼ - ì¢€ ë” ì—°í•œ ë¶‰ì€ ê³„ì—´ë¡œ ë³€ê²½ -->
<button 
onclick="clearCurrentAttendanceInputs()" 
style="margin-top: 1rem; background-color: #ffe5e5; color: #663333; padding: 0.8rem 1.2rem; font-size: 1.3rem;">
ì¶œì„ ëª…ë‹¨ ì „ì²´ ì‚­ì œ
</button>

  <div id="attendanceList" style="margin-top: 1rem;"></div>
  <button onclick="saveAttendance()" style="margin-top: 1rem; padding: 0.5rem 1rem;">ì¶œì„ ì €ì¥</button>
  <div id="attendanceSummary" style="margin-top: 1rem; background: #f3f3f3; padding: 1rem; border-radius: 8px;"></div>
</div>


  </div>
  <!-- ê²½ê¸° í¸ì„± 1ê²½ê¸° íƒ­ -->
<div id="matchTab" class="tab">
    <h2>ê²½ê¸° í¸ì„± 1ê²½ê¸°</h2>
  
    <!-- ì¶œì„ ë‚ ì§œ ì„ íƒ + ì¶œì„ ì¸ì› ì ìš© -->
    <div style="margin-bottom: 1rem; display: flex; align-items: center;">
        <label>ì¶œì„ ë‚ ì§œ:</label>
        <select id="matchDateSelect"></select>
        <button onclick="loadMatchPlayers()" style="margin-left: 1rem;">ì¶œì„ ì¸ì› ì ìš©í•˜ê¸°</button>
        <span style="margin-left: 3rem; font-weight: bold; font-size: 1.4rem;">ì´ ì¸ì›: <span id="matchTotal">0</span>ëª…</span>
      </div>
  
    <!-- CíŒ€ ì¸ì› ì„¤ì • -->
    <div style="margin-bottom: 2rem;">
      CíŒ€ ì¸ì› ìˆ˜: <input type="number" id="matchCInput" value="0" min="0" oninput="updateMatchCounts()">
    </div>
  
    <!-- AíŒ€ êµ¬ì—­ -->
<div style="background-color: #fff9c4; padding: 1rem; border-radius: 10px; margin-bottom: 1rem;">
    <div id="matchAInfo" style="font-weight: bold; font-size: 1.2rem;">AíŒ€ ì¶œì„ ì¸ì›: 0ëª…</div>
    <div style="margin-top: 0.7rem;">
      <label style="font-weight: bold;">AíŒ€ ì„ ë°œ ì¸ì›:</label>
      <div style="display: flex; align-items: center; gap: 10px;">
        <button onclick="adjustStarter('A', 1)">â–²</button>
        <input type="number" id="matchAStarter" value="11" min="1" style="width: 60px; text-align: center;" readonly>
        <button onclick="adjustStarter('A', -1)">â–¼</button>
      </div>
    </div>
    <div style="margin-top: 0.7rem;">
      <label><strong>AíŒ€ í¬ë©”ì´ì…˜ ì¶”ì²œ:</strong> <span id="suggestA" style="font-size: 1.2rem;"></span></label><br>
      <label><strong>AíŒ€ í¬ë©”ì´ì…˜:</strong></label>
      <select id="formationASelect" onchange="toggleCustomFormation('A')">
        <option value="">-- ì¶”ì²œ ì„ íƒ --</option>
        <!-- ìë™ìœ¼ë¡œ ì¶”ì²œê°’ ì¶”ê°€ë¨ -->
      </select>
      <div id="formationACustom" style="display: none; margin-top: 0.5rem;">
        DF: <input type="number" id="dfA" value="0" style="width: 50px;" />
        MF: <input type="number" id="mfA" value="0" style="width: 50px;" />
        FW: <input type="number" id="fwA" value="0" style="width: 50px;" />
      </div>
    </div>
  </div>
  
  
    <!-- BíŒ€ êµ¬ì—­ -->
<div style="background-color: #e0f7da; padding: 1rem; border-radius: 10px;">
    <div id="matchBInfo" style="font-weight: bold; font-size: 1.2rem;">BíŒ€ ì¶œì„ ì¸ì›: 0ëª…</div>
    <div style="margin-top: 0.7rem;">
      <label style="font-weight: bold;">BíŒ€ ì„ ë°œ ì¸ì›:</label>
      <div style="display: flex; align-items: center; gap: 10px;">
        <button onclick="adjustStarter('B', 1)">â–²</button>
        <input type="number" id="matchBStarter" value="11" min="1" style="width: 60px; text-align: center;" readonly>
        <button onclick="adjustStarter('B', -1)">â–¼</button>
      </div>
    </div>
    <div style="margin-top: 0.7rem;">
      <label><strong>BíŒ€ í¬ë©”ì´ì…˜ ì¶”ì²œ:</strong> <span id="suggestB" style="font-size: 1.2rem;"></span></label><br>
      <label><strong>BíŒ€ í¬ë©”ì´ì…˜:</strong></label>
      <select id="formationBSelect" onchange="toggleCustomFormation('B')">
        <option value="">-- ì¶”ì²œ ì„ íƒ --</option>
      </select>
      <div id="formationBCustom" style="display: none; margin-top: 0.5rem;">
        DF: <input type="number" id="dfB" value="0" style="width: 50px;" />
        MF: <input type="number" id="mfB" value="0" style="width: 50px;" />
        FW: <input type="number" id="fwB" value="0" style="width: 50px;" />
      </div>
    </div>
  </div>
  
    <!-- AíŒ€ í¬ë©”ì´ì…˜ ì¶”ì²œ + ì„ íƒ -->
    <div style="margin-bottom: 1rem;">
      <label><strong>AíŒ€ í¬ë©”ì´ì…˜ ì¶”ì²œ:</strong> <span id="suggestA">-</span></label><br>
      <label><strong>AíŒ€ í¬ë©”ì´ì…˜:</strong></label>
      <select id="formationASelect" onchange="toggleCustomFormation('A')">
        <option value="">-- ì¶”ì²œ ì„ íƒ --</option>
        <option value="4-4-2">4-4-2</option>
        <option value="4-3-3">4-3-3</option>
        <option value="3-5-2">3-5-2</option>
        <option value="custom">ì§ì ‘ ì…ë ¥</option>
      </select>
      <div id="formationACustom" style="display: none; margin-top: 0.5rem;">
        DF: <input type="number" id="dfA" value="0" style="width: 50px;" />
        MF: <input type="number" id="mfA" value="0" style="width: 50px;" />
        FW: <input type="number" id="fwA" value="0" style="width: 50px;" />
      </div>
    </div>
  
    <!-- BíŒ€ í¬ë©”ì´ì…˜ ì¶”ì²œ + ì„ íƒ -->
    <div style="margin-bottom: 1rem;">
      <label><strong>BíŒ€ í¬ë©”ì´ì…˜ ì¶”ì²œ:</strong> <span id="suggestB">-</span></label><br>
      <label><strong>BíŒ€ í¬ë©”ì´ì…˜:</strong></label>
      <select id="formationBSelect" onchange="toggleCustomFormation('B')">
        <option value="">-- ì¶”ì²œ ì„ íƒ --</option>
        <option value="4-4-2">4-4-2</option>
        <option value="4-3-3">4-3-3</option>
        <option value="3-5-2">3-5-2</option>
        <option value="custom">ì§ì ‘ ì…ë ¥</option>
      </select>
      <div id="formationBCustom" style="display: none; margin-top: 0.5rem;">
        DF: <input type="number" id="dfB" value="0" style="width: 50px;" />
        MF: <input type="number" id="mfB" value="0" style="width: 50px;" />
        FW: <input type="number" id="fwB" value="0" style="width: 50px;" />
      </div>
    </div>
  
    <!-- í¬ì§€ì…˜ ë½‘ê¸° -->
    <div style="margin-bottom: 2rem;">
      <button onclick="drawMatchPositions()">í¬ì§€ì…˜ ë½‘ê¸°</button>
    </div>
  
    <!-- ê²°ê³¼ ì¶œë ¥ -->
    <div id="matchResult" style="margin-top: 1.5rem;"></div>
  </div>
  
  
  <div id="memberTab" class="tab">
    <h2>íšŒì› ê´€ë¦¬</h2>
  
 <!-- íšŒì› ëª…ë‹¨ ì—…ë¡œë“œ -->
<div style="margin-bottom: 2.5rem; font-size: 1.5rem; line-height: 2.2rem;">
    <label style="font-weight: bold;">íšŒì› ëª…ë‹¨ ì—…ë¡œë“œ (ì—‘ì…€):</label><br>
  
    <!-- íŒŒì¼ ì„ íƒ ì˜ì—­ -->
    <div style="margin: 1rem 0;">
      <input type="file" id="excelFileInput" accept=".xlsx, .xls"
        style="font-size: 1.4rem; padding: 0.6rem 1rem; border-radius: 6px;"
        onchange="updateSelectedFileName(this)">
      <div id="fileNameDisplay" style="margin-top: 0.5rem; font-size: 1.5rem; color: #555;"></div>
    </div>
  
    <!-- ë²„íŠ¼ ê·¸ë£¹ -->
    <div style="display: flex; flex-wrap: wrap; gap: 1.2rem; margin-top: 1.5rem;">
      <button onclick="downloadMemberList()" style="flex: 1 1 45%; padding: 1.2rem; font-size: 1.3rem;">íšŒì› ëª…ë‹¨ ë³´ê¸°</button>
      <button onclick="toggleEditTeam()" style="flex: 1 1 45%; padding: 1.2rem; font-size: 1.3rem;">íšŒì› ì†Œì† ë³€ê²½</button>
      <button onclick="toggleIndividualDelete()" style="flex: 1 1 45%; padding: 1.2rem; font-size: 1.3rem;">íšŒì› ê°œë³„ ì‚­ì œ</button>
      <button onclick="deleteAllMembers()" style="flex: 1 1 45%; padding: 1.2rem; font-size: 1.3rem;">íšŒì› ëª…ë‹¨<br>ì „ì²´ ì‚­ì œ</button>
    </div>
  </div>
  
  <!-- íšŒì› ì§ì ‘ ì¶”ê°€ -->
<div style="margin-top: 3rem; margin-bottom: 2rem; font-size: 1.5rem;">
    <label style="font-weight: bold; display: block; margin-bottom: 1rem;">íšŒì› ì§ì ‘ ì¶”ê°€:</label>
  
    <input type="text" id="manualName" placeholder="ì„±ëª… ì…ë ¥"
      style="width: 160px; font-size: 1.3rem; padding: 0.6rem; margin-right: 1rem; margin-bottom: 1rem;" />
    
    <input type="text" id="manualTeam" placeholder="ì†Œì† ì…ë ¥"
      style="width: 200px; font-size: 1.3rem; padding: 0.6rem; margin-right: 1rem; margin-bottom: 1rem;" />
  
    <br>
    <button onclick="addManualMember()"
      style="padding: 0.7rem 1.4rem; font-size: 1.3rem;">íšŒì› ì§ì ‘ ì¶”ê°€</button>
  </div>
  
  
  
    <!-- íšŒì› ëª…ë‹¨ í‘œì‹œ -->
    <div id="memberListDisplay" style="margin-top:1rem;"></div>
  </div>
  

  </div>
<!-- ê²½ê¸° ì ìˆ˜ íƒ­ ì‹œì‘ -->
<!-- âœ… ê²½ê¸° ì ìˆ˜ íƒ­ ì „ì²´ êµ¬ì¡° -->
<div id="scoreTab" class="tab">
    <h2>ê²½ê¸° ì ìˆ˜</h2>
  
    <!-- ì‹œì¦Œ ì„¤ì • -->
    <div style="margin-bottom: 1rem; display: flex; align-items: center; flex-wrap: wrap; gap: 1.5rem;">
      <div style="flex: 1;">
        <label style="font-size: 1.3rem;">ì‹œì¦Œ ì‹œì‘ì¼:</label><br>
        <input type="date" id="seasonStart" value="2025-03-01" style="font-size: 1.3rem; padding: 0.5rem;">
        <br><br>
        <label style="font-size: 1.3rem;">ì‹œì¦Œ ë§ˆê°ì¼:</label><br>
        <input type="date" id="seasonEnd" value="2026-02-28" style="font-size: 1.3rem; padding: 0.5rem;">
      </div>
  
      <!-- í¬ìƒê¸ˆ ì„¤ì • ë²„íŠ¼ -->
      <div style="align-self: center;">
        <button onclick="openRewardSetting()" style="padding: 0.7rem 1.5rem; font-size: 1.1rem;">í¬ìƒê¸ˆ<br>ì„¤ì •</button>
      </div>
    </div>
  
    <!-- í¬ìƒê¸ˆ ì„¤ì • ì…ë ¥ ì˜ì—­ -->
    <div id="rewardSettingArea" style="display: none; margin-top: 1.5rem;"></div>
  
    <!-- ì¶œì„ ê´€ë¦¬ ë²„íŠ¼ + ì˜ì—­ -->
    <div style="margin-bottom: 1.5rem;">
      <button onclick="toggleAttendanceHistory()" style="padding: 0.8rem 1.2rem; font-size: 1.1rem;">ì¶œì„ ê´€ë¦¬</button>
    </div>
    <div id="attendanceHistoryArea" style="display: none; margin-top: 1.5rem; overflow: auto; max-height: 500px; max-width: 100%; border: 1px solid #ccc;"></div>
  
    <!-- TOP10 ìˆœìœ„ ë³´ê¸° -->
    <div style="margin-bottom: 1.5rem;">
      <button onclick="showTop10()" style="font-size: 1.3rem; padding: 1rem 1.5rem;">TOP10 ìˆœìœ„ ë³´ê¸°</button>
      <div id="top10Display" style="margin-top: 1rem; background: #fff8e1; padding: 1rem; border-radius: 8px;"></div>
    </div>
  
    <!-- ì „ì²´ íšŒì› ì ìˆ˜ í™•ì¸ -->
    <div style="margin-bottom: 2rem;">
      <button onclick="showAllScores()" style="font-size: 1.3rem; padding: 1rem 1.5rem;">ì „ì²´ íšŒì› ì ìˆ˜ í™•ì¸</button>
      <div id="allScoresArea" style="margin-top: 1rem;"></div>
      <canvas id="scoreChart" height="300" style="width:100%; max-height:400px;"></canvas>
    </div>
  </div>
  
  

  <!-- JS ì½”ë“œ -->
  <script>
    
    function showTab(tabId) {
  const tabs = document.querySelectorAll('.tab');
  tabs.forEach(tab => tab.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');

  // âœ… ê²½ê¸° í¸ì„± íƒ­ì„ ì—´ ë•Œë§Œ ë‚ ì§œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
  if (tabId === 'matchTab') {
    populateMatchDateList();
  }
}
    // ë‚ ì§œ ì„ íƒ ì´ˆê¸°í™”
const yearSelect = document.getElementById("yearSelect");
const monthSelect = document.getElementById("monthSelect");
const daySelect = document.getElementById("daySelect");
const weekdayDisplay = document.getElementById("weekdayDisplay");

function setupDateListeners() {
  const yearSelect = document.getElementById("yearSelect");
  const monthSelect = document.getElementById("monthSelect");
  const daySelect = document.getElementById("daySelect");

  const handler = () => {
    updateWeekday();                 // ìš”ì¼ ê°±ì‹ 
    clearCurrentAttendanceInputs(); // ì…ë ¥ ì´ˆê¸°í™”
    updateSelectOptions(document.querySelectorAll('.name-select'));
  };

  yearSelect.addEventListener("change", handler);
  monthSelect.addEventListener("change", handler);
  daySelect.addEventListener("change", handler);
}
function adjustStarter(team, delta) {
  const input = document.getElementById(`match${team}Starter`);
  let value = parseInt(input.value || 0);
  value += delta;
  if (value < 1) value = 1;
  input.value = value;
  suggestFormation(team);
}
function toggleCustomFormation(team) {
  const select = document.getElementById(`formation${team}Select`);
  const customDiv = document.getElementById(`formation${team}Custom`);

  if (select.value === "custom") {
    customDiv.style.display = "block";
  } else {
    customDiv.style.display = "none";
  }
}


function populateDateSelectors() {
  const now = new Date();
  const thisYear = now.getFullYear();

  // ì—°ë„ëŠ” ì˜¬í•´ë§Œ ì„ íƒ ê°€ëŠ¥
  yearSelect.innerHTML = `<option value="${thisYear}">${thisYear}ë…„</option>`;

  // ì›” ì´ˆê¸°í™”
  monthSelect.innerHTML = "";
  for (let m = 1; m <= 12; m++) {
    const option = document.createElement("option");
    option.value = m;
    option.textContent = `${m}ì›”`;
    monthSelect.appendChild(option);
  }

  // ì¼ ì´ˆê¸°í™”
  daySelect.innerHTML = "";
  for (let d = 1; d <= 31; d++) {
    const option = document.createElement("option");
    option.value = d;
    option.textContent = `${d}ì¼`;
    daySelect.appendChild(option);
  }

  // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì •
  monthSelect.value = now.getMonth() + 1;
  daySelect.value = now.getDate();
  updateWeekday();

}
function loadRankedAttendance() {
  if (memberList.length === 0) {
    alert("ë¨¼ì € íšŒì› ëª…ë‹¨ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.");
    return;
  }

  const container = document.getElementById("attendanceList");
  container.innerHTML = "";

  const table = document.createElement("table");
  table.style.borderCollapse = "collapse";
  table.style.width = "100%";
  table.innerHTML = "<tr><th>ìˆœìœ„</th><th>ì„±ëª… ì„ íƒ</th><th>ë¹„íšŒì› ì…ë ¥</th><th>ì§€ê°</th><th>ì¡°í‡´</th></tr>";

  for (let i = 0; i < 30; i++) {
    const row = document.createElement("tr");

    const rankCell = document.createElement("td");
    rankCell.textContent = `${i + 1}ë“±`;

    // ì½¤ë³´ë°•ìŠ¤ (ì„±ëª… ì„ íƒ)
    const select = document.createElement("select");
    select.className = "name-select";
    select.dataset.index = i;

    const defaultOption = document.createElement("option");
    defaultOption.value = "";
    defaultOption.textContent = "-- ì„ íƒ --";
    select.appendChild(defaultOption);

    const sortedList = [...memberList].sort((a, b) => a.name.localeCompare(b.name, "ko"));

    // í˜„ì¬ê¹Œì§€ ì„ íƒëœ ì´ë¦„ë“¤ í™•ì¸
    const selectedNames = Array.from(document.querySelectorAll(".name-select"))
      .map(sel => sel.value)
      .filter(name => name !== "");

    // ì¤‘ë³µ ì œê±°í•˜ë©° ì˜µì…˜ ì¶”ê°€
    sortedList.forEach(member => {
      if (selectedNames.includes(member.name)) return;

      const option = document.createElement("option");
      option.value = member.name;
      option.textContent = member.name;
      select.appendChild(option);
    });

    const selectCell = document.createElement("td");
    selectCell.appendChild(select);

    // ë¹„íšŒì› ì§ì ‘ ì…ë ¥
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "ë¹„íšŒì› ì…ë ¥";
    input.className = "manual-input";
    input.dataset.index = i;

    const inputCell = document.createElement("td");
    inputCell.appendChild(input);

    // ì§€ê° ì²´í¬
    const lateCheck = document.createElement("input");
    lateCheck.type = "checkbox";
    lateCheck.className = "late-check";
    lateCheck.dataset.index = i;

    const lateCell = document.createElement("td");
    lateCell.appendChild(lateCheck);

    // ì¡°í‡´ ì²´í¬
    const leaveCheck = document.createElement("input");
    leaveCheck.type = "checkbox";
    leaveCheck.className = "leave-check";
    leaveCheck.dataset.index = i;

    const leaveCell = document.createElement("td");
    leaveCell.appendChild(leaveCheck);

    // í–‰ì— ëª¨ë“  ì…€ ì¶”ê°€
    row.appendChild(rankCell);
    row.appendChild(selectCell);
    row.appendChild(inputCell);
    row.appendChild(lateCell);
    row.appendChild(leaveCell);

    table.appendChild(row);
  }

  container.appendChild(table);

  // ì´ë²¤íŠ¸ ë°”ì¸ë”©
  const selects = container.querySelectorAll(".name-select");
  selects.forEach(select => {
    select.addEventListener("change", () => {
      updateSelectOptions(selects);
      updateSummary();
    });
  });

  const inputs = container.querySelectorAll(".manual-input");
  inputs.forEach(input => input.addEventListener("input", updateSummary));

  const checkboxes = container.querySelectorAll(".late-check, .leave-check");
  checkboxes.forEach(chk => chk.addEventListener("change", updateSummary));

  updateSummary();
}


let matchPlayers = []; // 1ê²½ê¸° ì°¸ê°€ì ì €ì¥ìš©

function loadMatchPlayers() {
  const date = document.getElementById("matchDateSelect").value;

  if (!window.attendanceHistoryData || !attendanceHistoryData[date]) {
    alert("ì„ íƒí•œ ë‚ ì§œì— ì¶œì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  // âœ… ë¹„íšŒì› í¬í•¨ ì „ì²´ ì¶œì„ ëª…ë‹¨ ì‚¬ìš©
  matchPlayers = [...attendanceHistoryData[date]];
// ì¶œì„ ì¸ì›ì— ë§ê²Œ A/BíŒ€ ì„ ë°œ ì¸ì› ê¸°ë³¸ ì„¤ì •
const total = matchPlayers.length;
const cNum = parseInt(document.getElementById("matchCInput").value || 0);
const rest = Math.max(0, total - cNum);
const aNum = Math.ceil(rest / 2);
const bNum = Math.floor(rest / 2);

// AíŒ€ ì„ ë°œ ì¸ì›: ì¶œì„ ì¸ì›ê³¼ ê°™ê±°ë‚˜ ìµœëŒ€ 11ëª…
document.getElementById("matchAStarter").value = Math.min(aNum, 10);
// BíŒ€ ì„ ë°œ ì¸ì›: ì¶œì„ ì¸ì›ê³¼ ê°™ê±°ë‚˜ ìµœëŒ€ 11ëª…
document.getElementById("matchBStarter").value = Math.min(bNum, 10);
  updateMatchCounts(); // íŒ€ ì¸ì› ê³„ì‚° í•¨ìˆ˜ í˜¸ì¶œ
}
function updateMatchCounts() {
  const total = matchPlayers.length;
  const cNum = parseInt(document.getElementById("matchCInput").value || 0);
  const rest = Math.max(0, total - cNum);
  const aNum = Math.ceil(rest / 2);
  const bNum = Math.floor(rest / 2);

  document.getElementById("matchTotal").textContent = total;
  document.getElementById("matchA").textContent = aNum;
  document.getElementById("matchB").textContent = bNum;
  document.getElementById("matchC").textContent = cNum;
}
function suggestFormation(team) {
  const starter = parseInt(document.getElementById(`match${team}Starter`).value || 0);
  const target = document.getElementById(`suggest${team}`);
  const select = document.getElementById(`formation${team}Select`);
  const list = {
    12: ["4-5-2", "4-4-3", "3-4-4"],
    11: ["4-4-2", "4-3-3", "3-5-2", "3-4-3"], 
    10: ["4-4-1", "3-4-2", "3-5-1", "4-3-2"],
    9: ["3-4-1", "4-3-1", "3-3-2"],
    8: ["3-3-1", "2-4-1", "4-2-1"],
    7: ["3-3-0", "2-3-1", "3-2-1"]
  };
  const recommended = list[starter] || [];

  // ì¶”ì²œ í¬ë©”ì´ì…˜ í…ìŠ¤íŠ¸ ì¶œë ¥ (êµµê²Œ + í™•ëŒ€)
  target.textContent = recommended.join(", ");

  // ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì˜µì…˜ ì´ˆê¸°í™”
  select.innerHTML = '<option value="">-- ì¶”ì²œ ì„ íƒ --</option>';

  // ì¶”ì²œ í¬ë©”ì´ì…˜ì„ ì˜µì…˜ìœ¼ë¡œ ì¶”ê°€
  recommended.forEach(form => {
    const option = document.createElement("option");
    option.value = form;
    option.textContent = form;
    select.appendChild(option);
  });

  // 'ì§ì ‘ ì…ë ¥' ì˜µì…˜ ì¶”ê°€
  const customOption = document.createElement("option");
  customOption.value = "custom";
  customOption.textContent = "ì§ì ‘ ì…ë ¥";
  select.appendChild(customOption);
}
let formationA = null;
let formationB = null;

function drawMatchPositions() {
  // ì¶œì„í•œ ì¸ì› ë¶ˆëŸ¬ì˜¤ê¸°
  const players = [...matchPlayers];
  const restCount = parseInt(document.getElementById("matchCInput").value || 0);
  const playingPlayers = players.slice(0, players.length - restCount);
  const rest = players.slice(players.length - restCount);

  // íŒ€ ë‚˜ëˆ„ê¸° (ì§ìˆ˜ ì¸ë±ìŠ¤ AíŒ€, í™€ìˆ˜ ì¸ë±ìŠ¤ BíŒ€)
  const teamA = playingPlayers.filter((_, i) => i % 2 === 0);
  const teamB = playingPlayers.filter((_, i) => i % 2 === 1);

  // í¬ë©”ì´ì…˜ ë¶ˆëŸ¬ì˜¤ê¸°
  const formationASelect = document.getElementById("formationASelect").value;
  const formationBSelect = document.getElementById("formationBSelect").value;

  if (formationASelect === "custom") {
    const df = parseInt(document.getElementById("dfA").value || 0);
    const mf = parseInt(document.getElementById("mfA").value || 0);
    const fw = parseInt(document.getElementById("fwA").value || 0);
    formationA = `${df}-${mf}-${fw}`;
  } else {
    formationA = formationASelect || "-";
  }

  if (formationBSelect === "custom") {
    const df = parseInt(document.getElementById("dfB").value || 0);
    const mf = parseInt(document.getElementById("mfB").value || 0);
    const fw = parseInt(document.getElementById("fwB").value || 0);
    formationB = `${df}-${mf}-${fw}`;
  } else {
    formationB = formationBSelect || "-";
  }

  // ê²°ê³¼ HTML ì¶œë ¥
  let html = `<h3>AíŒ€ (${formationA})</h3><ul>${teamA.map(p => `<li>${p.name}</li>`).join("")}</ul>`;
  html += `<h3>BíŒ€ (${formationB})</h3><ul>${teamB.map(p => `<li>${p.name}</li>`).join("")}</ul>`;
  if (rest.length > 0) {
    html += `<h3>íœ´ì‹</h3><ul>${rest.map(p => `<li>${p.name}</li>`).join("")}</ul>`;
  }

  document.getElementById("matchResult").innerHTML = html;
}



function populateMatchDateList() {
  const select = document.getElementById("matchDateSelect");
  select.innerHTML = "";

  if (!attendanceHistoryData) return;

  const dates = Object.keys(attendanceHistoryData).sort();
  dates.forEach(date => {
    const option = document.createElement("option");
    option.value = date;
    option.textContent = date;
    select.appendChild(option);
  });
}


function assignTeams() {
  const numPlayers = parseInt(document.getElementById("matchCount").value);
  const formation = document.getElementById("formationSelect").value;
  const [df, mf, fw] = formation.split("-").map(Number);

  const selected = [...savedAttendanceData] // ì¶œì„ ì €ì¥ëœ ëª…ë‹¨
    .filter(p => memberList.map(m => m.name).includes(p.name))
    .slice(0, numPlayers);

  if (selected.length < numPlayers) {
    alert(`ì¶œì„ ì¸ì›ì´ ${numPlayers}ëª…ë³´ë‹¤ ì ìŠµë‹ˆë‹¤.`);
    return;
  }

  // ì…”í”Œ
  const shuffled = [...selected].sort(() => Math.random() - 0.5);

  const GK = shuffled[0].name;
  const DFs = shuffled.slice(1, 1 + df).map(p => p.name);
  const MFs = shuffled.slice(1 + df, 1 + df + mf).map(p => p.name);
  const FWs = shuffled.slice(1 + df + mf, 1 + df + mf + fw).map(p => p.name);

  // íŒ€ ë¶„í•  (ë‚˜ë¨¸ì§€ ì¸ì› ìë™ A/B ë°°ì •)
  const teamA = [], teamB = [];
  shuffled.forEach((p, i) => {
    if (i % 2 === 0) teamA.push(p.name);
    else teamB.push(p.name);
  });

  let html = `<h3>í¬ì§€ì…˜ ë°°ì • (${formation})</h3>`;
  html += `<p><strong>GK:</strong> ${GK}</p>`;
  html += `<p><strong>DF:</strong> ${DFs.join(", ")}</p>`;
  html += `<p><strong>MF:</strong> ${MFs.join(", ")}</p>`;
  html += `<p><strong>FW:</strong> ${FWs.join(", ")}</p>`;

  html += `<h3>AíŒ€</h3><ul>${teamA.map(n => `<li>${n}</li>`).join("")}</ul>`;
  html += `<h3>BíŒ€</h3><ul>${teamB.map(n => `<li>${n}</li>`).join("")}</ul>`;

  document.getElementById("teamResult").innerHTML = html;
}


function clearCurrentAttendanceInputs() {
  for (let i = 0; i < 30; i++) {
    const select = document.querySelector(`.name-select[data-index='${i}']`);
    const input = document.querySelector(`.manual-input[data-index='${i}']`);
    const late = document.querySelector(`.late-check[data-index='${i}']`);
    const leave = document.querySelector(`.leave-check[data-index='${i}']`);

    if (select) select.value = "";
    if (input) input.value = "";
    if (late) late.checked = false;
    if (leave) leave.checked = false;
  }

  updateSummary(); // ìš”ì•½ë„ ì´ˆê¸°í™”
}

function updateSelectOptions(selects) {
  const selectedNames = Array.from(selects)
    .map(select => select.value)
    .filter(name => name !== "");

  selects.forEach(select => {
    const current = select.value;
    Array.from(select.options).forEach(option => {
      if (option.value === "") return;
      option.disabled = selectedNames.includes(option.value) && option.value !== current;
    });
  });
}

function updateSelectOptions(selects) {
  const selectedNames = Array.from(selects)
    .map(select => select.value)
    .filter(name => name !== "");

  selects.forEach(select => {
    const current = select.value;
    Array.from(select.options).forEach(option => {
      if (option.value === "") return;
      option.disabled = selectedNames.includes(option.value) && option.value !== current;
    });
  });
}
function updateSummary() {
  const summaryDiv = document.getElementById("attendanceSummary");
  let summaryHtml = "<strong>í˜„ì¬ ì¶œì„ ìƒíƒœ ìš”ì•½:</strong><br>";

  for (let i = 0; i < 30; i++) {
    const select = document.querySelector(`.name-select[data-index='${i}']`);
    const input = document.querySelector(`.manual-input[data-index='${i}']`);
    const late = document.querySelector(`.late-check[data-index='${i}']`).checked;
    const leave = document.querySelector(`.leave-check[data-index='${i}']`).checked;

    const name = input.value.trim() !== "" ? input.value.trim() : select.value;
    if (name === "") continue;

    const flags = [];
    if (late) flags.push("ì§€ê°");
    if (leave) flags.push("ì¡°í‡´");

    summaryHtml += `${i + 1}ë“±: ${name} ${flags.length > 0 ? "(" + flags.join(", ") + ")" : ""}<br>`;
  }

  summaryDiv.innerHTML = summaryHtml;
}

let savedAttendanceData = [];

function saveAttendance() {
  savedAttendanceData = [];

  for (let i = 0; i < 30; i++) {
    const select = document.querySelector(`.name-select[data-index='${i}']`);
    const input = document.querySelector(`.manual-input[data-index='${i}']`);
    const late = document.querySelector(`.late-check[data-index='${i}']`).checked;
    const leave = document.querySelector(`.leave-check[data-index='${i}']`).checked;

    const name = input.value.trim() !== "" ? input.value.trim() : select.value;
    if (name === "") continue;

    const isPartial = late || leave;
    const score = isPartial ? 5 : 10;

    savedAttendanceData.push({
      rank: i + 1,
      name,
      late,
      leave,
      score
    });
  }

  // ë‚ ì§œ í‚¤
  const year = document.getElementById("yearSelect").value;
  const month = document.getElementById("monthSelect").value.padStart(2, '0');
  const day = document.getElementById("daySelect").value.padStart(2, '0');
  const dateKey = `${year}-${month}-${day}`;

  // ì €ì¥
  if (!window.attendanceHistoryData) window.attendanceHistoryData = {};
  window.attendanceHistoryData[dateKey] = [...savedAttendanceData];

  // âœ… localStorageì—ë„ ì €ì¥
  localStorage.setItem("attendanceHistoryData", JSON.stringify(attendanceHistoryData));

  alert(`ì¶œì„ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ (${dateKey})`);
  renderAttendanceHistory();

  // âœ… ì•„ë˜ ì„¸ ì¤„ì´ ëª¨ë‘ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤.
  updateTeamCounts();       
  populateDateSelectors();  
  setupDateListeners();     

  // âœ… ì´ ì¤„ë„ ë°˜ë“œì‹œ í¬í•¨ë˜ì–´ì•¼ í•¨
  populateMatchDateList();  // â† ì´ê²ƒì´ ê²½ê¸° í¸ì„± íƒ­ì— ë‚ ì§œ ëª©ë¡ì„ ë„£ëŠ” í•µì‹¬
}



function updateTeamCounts() {
  const total = savedAttendanceData.filter(p => memberList.map(m => m.name).includes(p.name)).length;
  const cNum = parseInt(document.getElementById("cTeamInput").value || 0);
  const rest = Math.max(0, total - cNum);
  const aNum = Math.ceil(rest / 2);
  const bNum = Math.floor(rest / 2);

  document.getElementById("totalCount").textContent = total;
  document.getElementById("cCount").textContent = cNum;
  document.getElementById("aCount").textContent = aNum;
  document.getElementById("bCount").textContent = bNum;
}


function renderAttendanceHistory() {
  const container = document.getElementById("attendanceHistory");
  if (!window.attendanceHistoryData || Object.keys(attendanceHistoryData).length === 0) {
  container.innerHTML = "<p>ì €ì¥ëœ ì¶œì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
  return;
}


  // ë‚ ì§œ ëª©ë¡ (ì—´)
  const dates = Object.keys(attendanceHistoryData).sort(); // ë‚ ì§œìˆœ ì •ë ¬

  // íšŒì› ëª©ë¡ (í–‰) - ê°€ë‚˜ë‹¤ìˆœ
  const sortedMembers = [...memberList].sort((a, b) => a.name.localeCompare(b.name, "ko"));

  // í‘œ ìƒì„±
  let html = "<table border='1' cellpadding='6' style='border-collapse: collapse; min-width: 600px; text-align: center;'>";

  // í—¤ë”
  html += "<thead><tr><th>ì„±ëª…</th>";
  dates.forEach(date => {
    html += `<th>${date}</th>`;
  });
  html += "</tr></thead><tbody>";

  // í–‰ ìƒì„±
  sortedMembers.forEach(member => {
    html += `<tr><td>${member.name}</td>`;

    dates.forEach(date => {
      const records = attendanceHistoryData[date];
      const entry = records.find(r => r.name === member.name);

      let status = "";
      if (entry) {
        if (entry.late || entry.leave) {
          status = "ì§€ê°"; // ì§€ê° or ì¡°í‡´ or ë‘˜ ë‹¤ â†’ ì§€ê°ìœ¼ë¡œ í‘œì‹œ
        } else {
          status = "ì°¸ì„";
        }
      }

      html += `<td>${status}</td>`;
    });

    html += "</tr>";
  });

  html += "</tbody></table>";
  container.innerHTML = html;
}



function updateWeekday() {
  const y = parseInt(yearSelect.value);
  const m = parseInt(monthSelect.value) - 1; // 0-indexed
  const d = parseInt(daySelect.value);
  const date = new Date(y, m, d);
  const weekday = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "][date.getDay()];
  
  weekdayDisplay.textContent = `${weekday}ìš”ì¼`;

  // ìƒ‰ìƒ ì§€ì •
  let color = "black";
  if (weekday === "í† ") color = "blue";
  if (weekday === "ì¼") color = "red";
  weekdayDisplay.style.color = color;
}

// ì´ë²¤íŠ¸ ë°”ì¸ë”©
yearSelect.addEventListener("change", updateWeekday);
monthSelect.addEventListener("change", updateWeekday);
daySelect.addEventListener("change", updateWeekday);

populateDateSelectors();
setupDateListeners();
let memberList = [];

document.getElementById("excelFileInput").addEventListener("change", function (e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: "array" });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];

    const memberData = [];
    let row = 3;

    while (true) {
      const nameCell = sheet[`B${row}`];
      const teamCell = sheet[`D${row}`];
      if (!nameCell && !teamCell) break;

      const name = nameCell ? nameCell.v.trim() : "";
      const team = teamCell ? teamCell.v.trim() : "";

      if (name !== "") {
        memberData.push({ name, team });
      }
      row++;
    }

    // âœ… ê¸°ì¡´ memberListì™€ ë³‘í•©
    const existingNames = new Set(memberList.map(m => m.name));
    const newMembers = memberData.filter(m => !existingNames.has(m.name));
    memberList = [...memberList, ...newMembers];

    // âœ… ì €ì¥
    localStorage.setItem("memberList", JSON.stringify(memberList));

    alert("ì—‘ì…€ íŒŒì¼ì˜ íšŒì› ëª…ë‹¨ì„ ê¸°ì¡´ ëª…ë‹¨ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.");
    downloadMemberList(); // í™”ë©´ ì¶œë ¥ ê°±ì‹ 
  };
  reader.readAsArrayBuffer(file);
});




function downloadMemberList() {
  const listArea = document.getElementById("memberListDisplay");

  if (memberList.length === 0) {
    listArea.innerHTML = "íšŒì› ëª…ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }

  // ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
  memberList.sort((a, b) => a.name.localeCompare(b.name, "ko"));

  let html = "<strong>íšŒì› ëª…ë‹¨:</strong><br><br>";
  html += `
    <table border="1" cellpadding="6" style="border-collapse: collapse; width: 100%; text-align: center;">
      <thead style="background-color: #f0f0f0;">
        <tr>
          <th>ì„±ëª…</th>
          <th>ì†Œì†</th>
          ${showEditTeamButtons ? "<th>ìˆ˜ì •</th>" : ""}
          ${showDeleteButtons ? "<th>ì‚­ì œ</th>" : ""}
        </tr>
      </thead>
      <tbody>
  `;

  memberList.forEach((m, i) => {
    html += `<tr>
      <td>${m.name}</td>
      <td id="teamCell${i}">
        ${m.team || ""}
        ${showEditTeamButtons ? `<button onclick="showEditTeamInput(${i})" style="margin-left: 6px;">ìˆ˜ì •</button>` : ""}
      </td>`;

    if (showEditTeamButtons) {
      html += `<td id="editCell${i}" style="display:none;">
        <input type="text" id="newTeam${i}" placeholder="ìˆ˜ì •í•  ì†Œì† ì…ë ¥" value="${m.team || ""}" />
        <button onclick="saveEditedTeam(${i})">ì €ì¥</button>
      </td>`;
    }

    if (showDeleteButtons) {
      html += `<td><button onclick="deleteMember(${i})" style="
        background-color: #f8d7da;
        color: #721c24;
        border: none;
        padding: 4px 10px;
        border-radius: 6px;
        cursor: pointer;"
        onmouseover="this.style.backgroundColor='#f5c6cb'" onmouseout="this.style.backgroundColor='#f8d7da'">ì‚­ì œ</button></td>`;
    }

    html += `</tr>`;
  });

  html += "</tbody></table>";
  listArea.innerHTML = html;
}


function addManualMember() {
  const nameInput = document.getElementById("manualName");
  const teamInput = document.getElementById("manualTeam");

  const name = nameInput.value.trim();
  const team = teamInput.value.trim();

  if (name === "") {
    alert("ì„±ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  // íšŒì› ì¶”ê°€
  memberList.push({ name, team });

  // âœ… ì €ì¥
  localStorage.setItem("memberList", JSON.stringify(memberList));

  // ì…ë ¥ì°½ ì´ˆê¸°í™”
  nameInput.value = "";
  teamInput.value = "";

  alert(`${name} ë‹˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
  downloadMemberList();
}




// ğŸ”½ ì—¬ê¸°ì— í•¨ê»˜ ì¶”ê°€
let showDeleteButtons = false;
let showEditTeamButtons = false;

function toggleIndividualDelete() {
  showDeleteButtons = !showDeleteButtons;
  downloadMemberList(); // ë‹¤ì‹œ ì¶œë ¥
}

function toggleEditTeam() {
  showEditTeamButtons = !showEditTeamButtons;
  downloadMemberList(); // ë‹¤ì‹œ ì¶œë ¥
}
function showEditTeamInput(index) {
  const editCell = document.getElementById(`editCell${index}`);
  if (editCell) editCell.style.display = "table-cell";
}


function deleteMember(index) {
  const pw = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  if (pw !== "0301") {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    return;
  }

  if (!confirm("ì´ íšŒì›ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

  memberList.splice(index, 1);

  // âœ… ì €ì¥
  localStorage.setItem("memberList", JSON.stringify(memberList));

  downloadMemberList();
  loadRankedAttendance(); // ì¶œì„ë¶€ì—ë„ ë°˜ì˜
}


function saveEditedTeam(index) {
  const newTeamInput = document.getElementById(`newTeam${index}`);
  const newTeam = newTeamInput.value.trim();

  if (memberList[index]) {
    memberList[index].team = newTeam;

    // âœ… ì €ì¥
    localStorage.setItem("memberList", JSON.stringify(memberList));

    alert(`ì†Œì†ì´ '${newTeam}'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    downloadMemberList();
  }
}



function deleteAllMembers() {
  const pw = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  if (pw !== "0301") {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    return;
  }

  if (!confirm("ì •ë§ë¡œ ëª¨ë“  íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

  memberList = [];

  // âœ… ì €ì¥
  localStorage.setItem("memberList", JSON.stringify(memberList));

  document.getElementById("memberListDisplay").innerHTML = "";
  document.getElementById("excelFileInput").value = "";
  alert("íšŒì› ëª…ë‹¨ì´ ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
  loadRankedAttendance();
}

function assignTiedRanks(data) {
  let rank = 1;
  let skip = 0;
  let prevScore = null;

  return data.map((item, index) => {
    if (item.score === prevScore) {
      skip++;
    } else {
      rank += skip;
      skip = 1;
    }
    prevScore = item.score;
    return { ...item, rank: rank };
  });
}


function showTop10() {
  const startDate = document.getElementById("seasonStart").value;
  const endDate = document.getElementById("seasonEnd").value;
  if (!startDate || !endDate) {
    alert("ì‹œì¦Œ ì‹œì‘ì¼ê³¼ ë§ˆê°ì¼ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.");
    return;
  }

  const allScores = getAllMemberScores();
const sorted = assignTiedRanks([...allScores].sort((a, b) => b.score - a.score || a.name.localeCompare(b.name, "ko"))).slice(0, 10);

  let html = `<strong>ì‹œì¦Œ ê¸°ê°„:</strong> ${startDate} ~ ${endDate}<br><br>`;
  html += `
    <table border="1" cellpadding="6" style="border-collapse: collapse; width:100%; text-align:center;">
      <thead style="background-color:#eee;">
        <tr>
          <th>ìˆœìœ„</th><th>ì´ë¦„</th><th>í¬ìƒê¸ˆ (ì˜ˆì •)</th>
        </tr>
      </thead><tbody>
  `;

  sorted.forEach(p => {
    const prize = prizeMap[p.rank] || 0;
    html += `<tr>
      <td>${p.rank}ìœ„</td>
      <td>${p.name}</td>
      <td>${prize.toLocaleString("ko-KR")}ì›</td>
    </tr>`;
  });

  html += `</tbody></table>`;
  document.getElementById("top10Display").innerHTML = html;
}

function getAllMemberScores() {
  if (!window.attendanceHistoryData || !Array.isArray(memberList)) return [];

  const memberNames = memberList.map(m => m.name); // ì •ì‹ íšŒì› ëª©ë¡
  const scores = {};

  for (const date in attendanceHistoryData) {
    attendanceHistoryData[date].forEach(entry => {
      if (memberNames.includes(entry.name)) {
        if (!scores[entry.name]) scores[entry.name] = 0;
        scores[entry.name] += entry.score;
      }
    });
  }

  return Object.entries(scores).map(([name, score]) => ({ name, score }));
}

// ê¸°ë³¸ í¬ìƒê¸ˆ ì„¤ì • (ìˆ˜ì • ê°€ëŠ¥)
let prizeMap = {
  1: 120000,
  2: 70000,
  3: 60000,
  4: 50000,
  5: 50000,
  6: 30000,
  7: 30000,
  8: 30000,
  9: 30000,
  10: 30000,
};

function openRewardSetting() {
  const pw = prompt("í¬ìƒê¸ˆ ì„¤ì •ì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  if (pw !== "0301") {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");
    return;
  }

  const container = document.getElementById("rewardSettingArea");
  container.style.display = "block";

  let html = "<strong>í¬ìƒê¸ˆ ì„¤ì • (â‚©):</strong><br>";

  for (let i = 1; i <= 10; i++) {
    html += `${i}ìœ„: <input type="number" id="prize${i}" value="${prizeMap[i]}" style="width:100px;"> ì›<br>`;
  }

  html += `<button onclick="savePrizeMap()" style="margin-top:10px;">ì €ì¥</button>`;
  container.innerHTML = html;
}


function savePrizeMap() {
  for (let i = 1; i <= 10; i++) {
    const input = document.getElementById(`prize${i}`);
    const value = parseInt(input.value);
    prizeMap[i] = isNaN(value) ? 0 : value;
  }

  document.getElementById("rewardSettingArea").innerHTML = "";
  document.getElementById("rewardSettingArea").style.display = "none";
  alert("í¬ìƒê¸ˆì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
}


function showTop10() {
  if (savedAttendanceData.length === 0) {
    alert("ì¶œì„ ì €ì¥ í›„ì— í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    return;
  }

  const startDate = document.getElementById("seasonStart").value;
  const endDate = document.getElementById("seasonEnd").value;

  if (!startDate || !endDate) {
    alert("ì‹œì¦Œ ì‹œì‘ì¼ê³¼ ë§ˆê°ì¼ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.");
    return;
  }
  let memberNames = memberList.map(m => m.name);
  let filtered = savedAttendanceData.filter(p => memberNames.includes(p.name));

  // í•©ì‚° ì ìˆ˜ ì •ë ¬ (í˜„ì¬ëŠ” ë‹¨ì¼ ì¶œì„ ì €ì¥ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬)
  const allScores = getAllMemberScores();
const sorted = assignTiedRanks([...allScores].sort((a, b) => b.score - a.score || a.name.localeCompare(b.name, "ko"))).slice(0, 10);

    let html = `<strong>ì‹œì¦Œ ê¸°ê°„:</strong> ${startDate} ~ ${endDate}<br><br>`;
html += `
  <table border="1" cellpadding="8" style="border-collapse: collapse; width: 100%; text-align: center;">
    <thead style="background-color: #eee;">
      <tr>
        <th>ìˆœìœ„</th>
        <th>ì´ë¦„</th>
        <th>í¬ìƒê¸ˆ (ì˜ˆì •)</th>
      </tr>
    </thead>
    <tbody>
`;

sorted.forEach((p) => {
  const prize = prizeMap[p.rank] || 0;
  const prizeStr = prize.toLocaleString("ko-KR") + "ì›";
  html += `
    <tr>
      <td>${p.rank}ìœ„</td>
      <td>${p.name}</td>
      <td>${prizeStr}</td>
    </tr>`;
});

html += `</tbody></table>`;
document.getElementById("top10Display").innerHTML = html;

}


function showAllScores() {
  const allScores = getAllMemberScores();
  const sorted = assignTiedRanks([...allScores].sort((a, b) => b.score - a.score || a.name.localeCompare(b.name, "ko")));

  // í…Œì´ë¸” ì¶œë ¥
  let maxScore = Math.max(...sorted.map(p => p.score));
let html = `
  <table border="1" cellpadding="6" style="border-collapse: collapse; width:100%; text-align:center;">
    <thead style="background-color:#eee;">
      <tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ì ìˆ˜</th><th>ì°¸ì—¬ ì •ë„</th></tr>
    </thead><tbody>
`;

sorted.forEach(p => {
  const percent = (p.score / maxScore) * 100;
  html += `
    <tr>
      <td>${p.rank}ìœ„</td>
      <td>${p.name}</td>
      <td>${p.score}</td>
      <td>
        <div style="background:#eee; width:100%; height:20px; border-radius:4px; overflow:hidden;">
          <div style="background:#4caf50; width:${percent}%; height:100%;"></div>
        </div>
      </td>
    </tr>
  `;
});

html += `</tbody></table>`;
document.getElementById("allScoresArea").innerHTML = html;

}


function drawScoreChart(data) {
  const ctx = document.getElementById("scoreChart").getContext("2d");
  if (window.scoreChartInstance) {
    window.scoreChartInstance.destroy();
  }

  const labels = data.map(p => p.name);
  const scores = data.map(p => p.score);

  window.scoreChartInstance = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [{
      label: 'ì°¸ì—¬ ì ìˆ˜',
      data: scores,
      backgroundColor: 'rgba(75, 192, 192, 0.6)',
      borderColor: 'rgba(75, 192, 192, 1)',
      borderWidth: 1
    }]
  },
  options: {
    indexAxis: 'y', // ê°€ë¡œ ë§‰ëŒ€ê·¸ë˜í”„
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
      title: {
        display: true,
        text: 'íšŒì›ë³„ ì¶œì„ ì°¸ì—¬ ì ìˆ˜',
        font: { size: 14 }
      }
    },
    scales: {
      x: { beginAtZero: true, precision: 0 }
    }
  }
});

}

function toggleAttendanceHistory() {
  const area = document.getElementById("attendanceHistoryArea");
  if (area.style.display === "none") {
    renderAttendanceHistory(); // í…Œì´ë¸” ìƒì„±
    area.style.display = "block";
  } else {
    area.style.display = "none";
  }
}

function renderAttendanceHistory() {
  const container = document.getElementById("attendanceHistoryArea");
  if (!window.attendanceHistoryData || Object.keys(attendanceHistoryData).length === 0) {
    container.innerHTML = "<p>ì €ì¥ëœ ì¶œì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
    return;
  }

  const dates = Object.keys(attendanceHistoryData).sort();
  const sortedMembers = [...memberList].sort((a, b) => a.name.localeCompare(b.name, "ko"));

  let html = "<table border='1' cellpadding='6' style='border-collapse: collapse; min-width: 600px; text-align: center;'>";
  html += "<thead><tr><th>ì„±ëª…</th>";
  dates.forEach(date => {
    html += `<th>${date}</th>`;
  });
  html += "</tr></thead><tbody>";

  sortedMembers.forEach(member => {
    html += `<tr><td>${member.name}</td>`;
    dates.forEach(date => {
      const records = attendanceHistoryData[date];
      const entry = records.find(r => r.name === member.name);
      let status = "";
      if (entry) {
        status = (entry.late || entry.leave) ? "ì§€ê°" : "ì°¸ì„";
      }
      html += `<td>${status}</td>`;
    });
    html += "</tr>";
  });

  html += "</tbody></table>";
  container.innerHTML = html;
}

  </script>
<!-- XLSX ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
   window.addEventListener('DOMContentLoaded', () => {
  // âœ… ì¶œì„ ì´ë ¥ ë³µì›
  const savedData = localStorage.getItem("attendanceHistoryData");
  if (savedData) {
    try {
      window.attendanceHistoryData = JSON.parse(savedData);
      renderAttendanceHistory();
      populateMatchDateList();
    } catch (e) {
      console.error("ì¶œì„ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", e);
    }
  } else {
    window.attendanceHistoryData = {};
  }

  // âœ… memberList ë³µì›
  const savedMembers = localStorage.getItem("memberList");
  if (savedMembers) {
    try {
      memberList = JSON.parse(savedMembers);
    } catch (e) {
      console.error("íšŒì› ëª…ë‹¨ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", e);
      memberList = [];
    }
  } else {
    memberList = [];
  }

  // í¬ë©”ì´ì…˜ ì¶”ì²œ ìë™ ì—°ê²°
  document.getElementById("matchAStarter").addEventListener("input", () => suggestFormation("A"));
  document.getElementById("matchBStarter").addEventListener("input", () => suggestFormation("B"));
});


  </script>
  
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>